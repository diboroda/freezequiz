<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –≤–µ–¥—É—â–µ–≥–æ - –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; text-align: center; }
        #queue { list-style: none; padding: 0; min-height: 200px; }
        #queue li { background: #f0f0f0; margin: 10px 0; padding: 15px; border-radius: 5px; }
        button { background: #4CAF50; color: white; padding: 15px 32px; border: none; border-radius: 5px; margin: 10px; cursor: pointer; }
        #resetBtn { background: #f44336; }
        .participant-link { margin: 30px 0; padding: 15px; background: #e7f3ff; border-radius: 5px; word-break: break-all; }
        .waiting { background: #fff3cd; color: #856404; padding: 10px; border-radius: 5px; }
        .active { background: #d4edda; color: #155724; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>üé§ –ü–∞–Ω–µ–ª—å –≤–µ–¥—É—â–µ–≥–æ - –í–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>
    
    <div class="participant-link">
        <strong>–°—Å—ã–ª–∫–∞ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:</strong><br>
        <span id="participantUrl">...</span>
    </div>

    <div id="status" class="waiting">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–Ω—è—Ç—ã—Ö —Ä—É–∫...</div>

    <h2>–û—á–µ—Ä–µ–¥—å –æ—Ç–≤–µ—Ç–∞:</h2>
    <ul id="queue"></ul>

    <div>
        <button id="nextBtn" disabled>–°–ª–µ–¥—É—é—â–∏–π –≤ –æ—á–µ—Ä–µ–¥–∏</button>
        <button id="resetBtn">–°–±—Ä–æ—Å–∏—Ç—å –æ—á–µ—Ä–µ–¥—å</button>
    </div>

    <script>
        // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Å—ã–ª–∫—É –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const baseUrl = window.location.href.replace(/\/$/, '');
        document.getElementById('participantUrl').textContent = baseUrl + '/participant.html';

        let queue = [];
        let lastResetTime = Date.now();
        
        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        function checkForNewParticipants() {
            try {
                const raises = JSON.parse(localStorage.getItem('handRaises') || '[]');
                
                if (raises.length > 0) {
                    raises.forEach(raise => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —É—á–∞—Å—Ç–Ω–∏–∫ –µ—â–µ –Ω–µ –≤ –æ—á–µ—Ä–µ–¥–∏ –∏ –ø–æ–¥–Ω—è–ª —Ä—É–∫—É –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–±—Ä–æ—Å–∞
                        if (!queue.find(p => p.id === raise.participantId) && raise.timestamp > lastResetTime) {
                            queue.push({
                                id: raise.participantId,
                                name: raise.name,
                                timestamp: raise.timestamp
                            });
                        }
                    });
                    
                    // –û—á–∏—â–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø–æ–¥–Ω—è—Ç–∏–π —Ä—É–∫
                    localStorage.setItem('handRaises', '[]');
                    renderQueue();
                }
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤:', e);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∏ –æ—á–µ—Ä–µ–¥–∏
        function renderQueue() {
            const queueElement = document.getElementById('queue');
            const statusElement = document.getElementById('status');
            
            queueElement.innerHTML = '';
            
            if (queue.length === 0) {
                statusElement.textContent = '–û—á–µ—Ä–µ–¥—å –ø—É—Å—Ç–∞. –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–Ω—è—Ç—ã—Ö —Ä—É–∫...';
                statusElement.className = 'waiting';
                document.getElementById('nextBtn').disabled = true;
                return;
            }
            
            statusElement.textContent = `–í –æ—á–µ—Ä–µ–¥–∏: ${queue.length} —á–µ–ª–æ–≤–µ–∫(–∞)`;
            statusElement.className = 'active';
            document.getElementById('nextBtn').disabled = false;
            
            queue.forEach((participant, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<strong>${index + 1}.</strong> ${participant.name}`;
                queueElement.appendChild(li);
            });
        }
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (queue.length > 0) {
                const nextParticipant = queue.shift();
                alert(`–°–ª–µ–¥—É—é—â–∏–π: ${nextParticipant.name}`);
                renderQueue();
            }
        });
        
        document.getElementById('resetBtn').addEventListener('click', () => {
            queue = [];
            lastResetTime = Date.now();
            
            // –°–æ–æ–±—â–∞–µ–º –≤—Å–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º –æ —Å–±—Ä–æ—Å–µ
            localStorage.setItem('quizReset', lastResetTime.toString());
            
            renderQueue();
            alert('–û—á–µ—Ä–µ–¥—å —Å–±—Ä–æ—à–µ–Ω–∞! –£—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç —Å–Ω–æ–≤–∞ –ø–æ–¥–Ω–∏–º–∞—Ç—å —Ä—É–∫–∏.');
        });
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(checkForNewParticipants, 1000);
        
        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
        renderQueue();
    </script>
</body>
</html>